webpackJsonp([7],{BO1k:function(t,e,s){t.exports={default:s("fxRn"),__esModule:!0}},BktS:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("BO1k"),o=s.n(i),a=s("bOdI"),n=s.n(a),l=s("IcnI"),r=s("oFuF"),v=s("7+uW"),c=l.a.state.contractPath,f=s("tBpT"),d=s("q+Vb")("./deployments."+c+".json"),u={data:function(){var t;return t={myPixelsDialogVisiable:!1,voteDialogVisible:!1,voteDetailVisible:!1,voteNum:0,voteNft:null,pixelContract:null,voteContract:null,tokenContract:null,myBalance:0,proposalID:"",proposal:{},voteNfts:null},n()(t,"voteNft",null),n()(t,"txs",{}),n()(t,"loadings",{}),n()(t,"myVoteNfts",[]),n()(t,"myVotesDialogVisiable",!1),n()(t,"myVoteInfo",{}),t},beforeMount:function(){},mounted:function(){this.initContract()},computed:{web3:function(){return this.$store.state.web3}},watch:{web3:function(t,e){this.initContract()}},methods:n()({initContract:function(){if(this.web3&&this.web3.web3Instance&&!this.pixelContract){var t=this.web3.web3Instance();this.pixelAddress=d.Pixel.address,this.pixelContract=new t.eth.Contract(d.Pixel.abi,d.Pixel.address,{from:this.web3.coinbase}),this.voteAddress=d.PixelVote.address,this.voteContract=new t.eth.Contract(d.PixelVote.abi,d.PixelVote.address,{from:this.web3.coinbase}),this.getInfo()}},getInfo:function(){this.getBnbBalance(),this.checkStateAlive("votesWorks")},getTokenAllowance:function(){var t=this;this.tokenContract.methods.allowance(this.web3.coinbase,this.voteAddress).call({from:this.$store.state.contractFrom}).then(function(e){t.myAllowance=e})},getBnbBalance:function(){var t=this;this.web3.web3Instance().eth.getBalance(this.web3.coinbase).then(function(e){t.myBalance=e})},getTokenBalance:function(){var t=this;this.tokenContract.methods.balanceOf(this.web3.coinbase).call({from:this.$store.state.contractFrom}).then(function(e){t.myBalance=e})},getVoteInfo:function(){var t=this;this.voteContract.methods.proposalID().call().then(function(e){t.proposalId=e,0!=e&&(t.voteContract.methods.proposals(e).call().then(function(e){var s=parseInt(new Date/1e3),i=0,o=0;e.signupTime>s?(o=0,i=e.signupTime-s):e.signupTime<s&&e.voteTime>s?(o=1,i=e.voteTime-s):e.voteTime<s&&e.endTime>s?(o=2,i=e.endTime-s):o=3,e.status=o,e.remainTime=i,e.remainTimeStr=r.a.countdownHour(i),t.proposal=e}),t.voteContract.methods.getProposal(e,t.web3.coinbase,0,0).call().then(function(e){var s=[],i=[];for(var a in e[1]){var n=e[1][a],l=t.getCardType(n.topic),v={id:a,amount:n.amount,nftId:n.nftId,owner:n.owner,topic:l,status:n.status,votes:n.votes,nft:r.a.getPixelInfo(n.nftId)};i.push(n.nftId),s.push(v)}t.pixelContract.methods.getPixelInfos(i).call({from:t.$store.state.contractFrom}).then(function(e){var i=[],a=!0,n=!1,l=void 0;try{for(var r,v=o()(e);!(a=(r=v.next()).done);a=!0){var c=r.value,f=c.url,d={id:c.id,name:c.name,url:f,mintTime:c.mintTime};i.push(d)}}catch(t){n=!0,l=t}finally{try{!a&&v.return&&v.return()}finally{if(n)throw l}}for(var u=0;u<s.length;u++)s[u].nft=i[u];var m=[];for(var _ in s)s[_].owner.toLowerCase()==t.web3.coinbase.toLowerCase()&&m.push(s[_]);s.sort(function(t,e){return t.votes-e.votes>=0?-1:1}),t.myVoteNfts=m,t.voteNfts=s,console.log(t.voteNfts),t.$store.commit("setVotesWorks",s)})}))})},showMyVotesDialog:function(){this.myVotesDialogVisiable=!0,this.getMyVoter(this.proposalId)},getMyVoter:function(t){var e=this;this.voteContract.methods.getProposalVoter(t,this.web3.coinbase).call().then(function(t){e.myVoteInfo=t})},showMyPixelsDialog:function(){this.myPixelsDialogVisiable=!0},openVotesDialog:function(t){this.voteNft=t,this.voteDialogVisible=!0,this.getMyVoteNftInfo(this.proposalId,this.voteNft.id)},getMyVoteNftInfo:function(t,e){var s=this;this.voteContract.methods.getProposalNftVoter(t,e,this.web3.coinbase).call().then(function(t){s.voteNft.my=t,s.voteAmount=s.getVoteAmount(s.voteNumber)})},getNftVoters:function(t,e){var s=this;this.nftVoters=[],this.voteContract.methods.getProposalNftVoters(t,e,0,0).call().then(function(t){var e=[];for(var i in t[1]){var o=t[1][i],a=t[0][i];a=a.slice(0,4)+"***"+a.slice(-4),e.push({account:a,amount:Number(o.amount/Math.pow(10,18)).toFixed(2),votes:o.votes,rank:0})}for(var i in e.sort(function(t,e){return t.votes-e.votes>0?-1:1}),e)e[i].rank=parseInt(i)+1;s.nftVoters=e})},getVoteAmount:function(t){var e=this.voteNft.my?this.voteNft.my.votes:0;e=parseInt(e),e=0;for(var s=0,i=1;i<=parseInt(t);i++)if(e+i>this.proposal.sqrtVote){var o=e+i-this.proposal.sqrtVote;s+=this.proposal.unitAmount/Math.pow(10,18)/10*o}else s+=this.proposal.unitAmount/Math.pow(10,18);return s},vote:function(t){var e=this.voteNum,s=(this.voteNft.my&&this.voteNft.my.votes,this.web3.web3Instance().utils.toWei(this.getVoteAmount(e)+""));r.a.compareTo(this.myAllowance,s)<0?this.approvalVote(t,e):this.voteConfirm(t,e)},approvalVote:function(t,e){this.showLoading(i18n.t("nav.authorizing"));var s=this;this.tokenContract.methods.approve(this.voteAddress,r.a.infinity).send({gasPrice:this.web3.gasPrice}).on("transactionHash",function(t){console.log(t),s.showLoading(i18n.t("nav.authorizeonchain"))}).on("receipt",function(i){console.log(i),s.txs[i.transactionHash]||(s.txs[i.transactionHash]=i.transactionHash,s.hideLoading(),s.$message({message:i18n.t("pixel.authorizesuccess"),type:"info",center:!0}),s.getTokenAllowance(),s.voteConfirm(t,e))}).on("confirmation",function(t,e){console.log(t)}).on("error",function(t){console.log(t),s.hideLoading();var e=t&&t.message?t.message:"";s.$message({message:i18n.t("nav.authorizefailed")+e,type:"error",center:!0})})},voteConfirm:function(t,e){var s=this,i=this.proposalId;v.default.set(s.loadings,"vote"+t,!0),s.voteContract.methods.castVote(i,t,e).estimateGas({from:this.web3.coinbase},function(o,a){if(o){console.log(o,a);var n=r.a.errMsg(o);return s.$message({message:"投票失败"+n,type:"warning",center:!0}),void v.default.set(s.loadings,"vote"+t,!1)}s.voteContract.methods.castVote(i,t,e).send({gasPrice:s.web3.gasPrice,gas:a}).on("transactionHash",function(t){console.log("buyConfirm",t),s.$message({message:i18n.t("pixel.voteonchain"),type:"info",center:!0}),s.nftVoteDialogVisiable=!1}).on("receipt",function(e){console.log("buyConfirm",e),s.txs[e.transactionHash]||(s.txs[e.transactionHash]=e.transactionHash,v.default.set(s.loadings,"vote"+t,!1),s.getInfo(),s.$message({message:i18n.t("pixel.votesuccess"),type:"success",center:!0}))}).on("confirmation",function(t,e){console.log("buyConfirm",t)}).on("error",function(e){v.default.set(s.loadings,"vote"+t,!1),s.$message({message:i18n.t("pixel.votefailed")+e.message,type:"warning",center:!0})})})},getCardType:function(t){return f.nfts[t]?f.nfts[t].name.zh:""},checkStateAlive:function(t){this.$store.state[t]?this.voteNfts=this.$store.state[t]:this.getVoteInfo()},closeVotesDialog:function(){this.voteDialogVisible=!1},hideLoading:function(){if(this.loading)return this.loading.close(),void(this.loading=null)},showLoading:function(t){this.loading?this.loading.text=t:this.loading=this.$loading({lock:!0,text:t,spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})}},"closeVotesDialog",function(){this.voteDialogVisible=!1}),filters:{filterTime:function(t){return r.a.formatDate(t,"MM-dd hh:mm")},filterAccount:function(t){return t.slice(0,4)+"***"+t.slice(-4)},filterAmount:function(t){return Number(t/Math.pow(10,18)).toFixed(2)}},beforeDestroy:function(){this.hideLoading()}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"pixel-container"},[s("div",{staticClass:"valid-container"},[s("div",{staticClass:"votes-detail"},[t._m(0),t._v(" "),s("div",{staticClass:"my-votes-info"},[s("div",{staticClass:"total-votes"},[s("div",{staticClass:"title"},[t._v("我的投票")]),t._v(" "),s("div",{staticClass:"number"},[s("el-button",{staticClass:"gradient resteek",attrs:{round:""},on:{click:t.showMyVotesDialog}},[t._v("查看")])],1)]),t._v(" "),s("div",{staticClass:"total-bnb"},[s("div",{staticClass:"title"},[t._v("我的作品")]),t._v(" "),s("div",{staticClass:"number"},[s("el-button",{staticClass:"gradient resteek",attrs:{round:""},on:{click:t.showMyPixelsDialog}},[t._v("查看")])],1)])])]),t._v(" "),s("div",{staticClass:"my-works"},[s("div",{staticClass:"part-title"},[s("div",{staticClass:"left-border"}),t._v(" "),s("div",{staticClass:"center-text"},[t._v(t._s(t.$t("pixel.voterank")))]),t._v(" "),s("div",{staticClass:"more"},[s("span",[s("router-link",{staticStyle:{"text-decoration":"none",color:"#584e5a"},attrs:{to:"/pixel/activity"}},[t._v(t._s(t.$t("pixel.actdetail")))])],1),t._v(" "),t._m(1)])]),t._v(" "),s("div",{staticClass:"works-list"},[t.voteNfts?t._l(t.voteNfts,function(e,i){return s("div",{key:i,staticClass:"work-item"},[s("div",{staticClass:"item-img",style:{backgroundImage:"url("+e.nft.url+")"}},[i<3?s("div",{staticClass:"rank-3"},[s("span",[t._v("NO."+t._s(i+1))]),t._v(" "),s("span",{staticClass:"crown"})]):t._e()]),t._v(" "),s("div",{staticClass:"item-name"},[t._v(t._s(e.nft.name))]),t._v(" "),s("div",{staticClass:"item-info"},[s("div",{staticClass:"info-li"},[s("span",[t._v(t._s(t.$t("pixel.creator")))]),t._v(" "),s("span",[t._v(t._s(t._f("filterAccount")(e.owner)))])]),t._v(" "),s("div",{staticClass:"info-li"},[s("span",[t._v(t._s(t.$t("pixel.createtime")))]),t._v(" "),s("span",[t._v(t._s(t._f("filterTime")(e.nft.mintTime)))])]),t._v(" "),s("div",{staticClass:"info-li"},[s("span",[t._v(t._s(t.$t("pixel.votes")))]),t._v(" "),s("span",[t._v(t._s(e.votes))])]),t._v(" "),s("div",{staticClass:"info-li"},[s("span",[t._v("BNB")]),t._v(" "),s("span",[t._v(t._s(t._f("filterAmount")(e.amount)))])])]),t._v(" "),s("div",{staticClass:"item-btn"},[s("el-button",{staticClass:"size gradient",attrs:{round:"",loading:!1},on:{click:function(s){return t.openVotesDialog(e)}}},[t._v(t._s(t.$t("pixel.vote")))])],1)])}):s("div",{staticClass:"round-loader"})],2)]),t._v(" "),s("div",{staticClass:"bottom-tips"},[t._v(t._s(t.$t("pixel.govote")))])]),t._v(" "),t.voteNft?s("el-dialog",{staticClass:"votes-dialog",attrs:{visible:t.voteDialogVisible,title:t.$t("pixel.vote"),width:"40","modal-append-to-body":!1},on:{"update:visible":function(e){t.voteDialogVisible=e}}},[s("div",{staticClass:"nft-img",style:{backgroundImage:"url("+t.voteNft.nft.url+")"}},[s("div",{staticClass:"nft-name"},[t._v(t._s(t.voteNft.topic))])]),t._v(" "),s("div",{staticClass:"nft-info"},[s("div",{staticClass:"info-list"},[s("div",{staticClass:"devide"},[s("span",[t._v(t._s(t.$t("pixel.votesnow")))]),t._v(" "),s("span",[t._v(t._s(t.voteNft.votes))])]),t._v(" "),s("div",{staticClass:"devide"},[s("span",[t._v(t._s(t.$t("pixel.voted")))]),t._v(" "),s("span",[t._v(t._s(t.voteNft.my?t.voteNft.my.votes:0))])])]),t._v(" "),s("div",{staticClass:"info-list"},[s("div",{staticClass:"devide"},[s("span",[t._v(t._s(t.$t("pixel.bnbvoted")))]),t._v(" "),s("span",[t._v(t._s(t._f("filterAmount")(t.voteNft.my?t.voteNft.my.amount:0))+"BNB")])]),t._v(" "),s("div",{staticClass:"devide"},[s("span",[t._v(t._s(t.$t("common.balance")))]),t._v(" "),s("span",[t._v(t._s(t._f("filterAmount")(t.myBalance)))])])])]),t._v(" "),s("div",{staticClass:"votes-input"},[s("span",[t._v(t._s(t.$t("pixel.votenum")))]),t._v(" "),s("el-input-number",{attrs:{min:0},model:{value:t.voteNum,callback:function(e){t.voteNum=e},expression:"voteNum"}})],1),t._v(" "),s("div",{staticClass:"votes-btn"},[s("el-button",{staticClass:"size gradient",attrs:{round:"",loading:!1},on:{click:function(e){return t.vote(t.voteNft.id)}}},[t._v(t._s(t.$t("pixel.confirmvote")))])],1),t._v(" "),s("div",{staticClass:"votes-tips"},[t._v(t._s(t.$t("pixel.countmethod")))]),t._v(" "),s("div",{staticClass:"close-btn",on:{click:function(e){return t.closeVotesDialog()}}},[t._v(t._s(t.$t("pixel.cancelvote")))])]):t._e(),t._v(" "),s("el-dialog",{attrs:{title:"投票详情",visible:t.voteDetailVisible},on:{"update:visible":function(e){t.voteDetailVisible=e}}},[s("div",{staticClass:"vote-detail-body"},[s("div",{staticClass:"table-head"},[s("div",{staticClass:"table-item"},[t._v(t._s(t.$t("collect.rank")))]),t._v(" "),s("div",{staticClass:"table-item"},[t._v(t._s(t.$t("common.account")))]),t._v(" "),s("div",{staticClass:"table-item"},[t._v(t._s(t.$t("pixel.votes")))]),t._v(" "),s("div",{staticClass:"table-item"},[t._v("BNB")])]),t._v(" "),s("div",{staticClass:"table-body"},[s("div",{staticClass:"table-content"},t._l(15,function(e){return s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-item"},[t._v("1")]),t._v(" "),s("div",{staticClass:"table-item"},[t._v("0x98***4605")]),t._v(" "),s("div",{staticClass:"table-item"},[t._v("315")]),t._v(" "),s("div",{staticClass:"table-item"},[t._v("2422.00")])])}),0)])])]),t._v(" "),s("el-dialog",{attrs:{title:"我的作品",visible:t.myPixelsDialogVisiable,center:""},on:{"update:visible":function(e){t.myPixelsDialogVisiable=e}}},[s("div",{staticClass:"nfts-box"},[s("div",{staticClass:"nft-items"},t._l(t.myVoteNfts,function(e){return s("div",{staticClass:"nft-item"},[s("div",{staticClass:"nft-img"},[s("img",{attrs:{src:e.nft.url}})]),t._v(" "),s("div",{staticClass:"nft-info"},[s("div",{staticClass:"nft-name"},[t._v(t._s(e.nft.name))]),t._v(" "),s("div",{staticClass:"nft-owner"},[s("span",[t._v(t._s(t.$t("pixel.topic")))]),t._v(" "),s("span",[t._v(t._s(e.topic))])]),t._v(" "),s("div",{staticClass:"nft-votes"},[s("span",[t._v(t._s(t.$t("pixel.votes")))]),t._v(" "),s("span",[t._v(t._s(e.votes))])]),t._v(" "),s("div",{staticClass:"nft-amount"},[s("span",[t._v("BNB")]),t._v(" "),s("span",[t._v(t._s(t._f("filterAmount")(e.amount))+" BNB")])]),t._v(" "),s("div",{staticClass:"nft-button"},[1!=e.status?s("el-button",{attrs:{type:"primary",loading:t.loadings["withdrawnft"+e.id],disabled:3!=t.proposal.status},on:{click:function(s){return t.withdrawNft(e.id)}}},[t._v("赎回")]):t._e()],1),t._v(" "),1==e.status?s("div",{staticStyle:{"text-align":"center",display:"block"}},[t._v("已赎回")]):t._e()])])}),0)])]),t._v(" "),s("el-dialog",{attrs:{title:"我的投票",visible:t.myVotesDialogVisiable,center:""},on:{"update:visible":function(e){t.myVotesDialogVisiable=e}}},[s("div",{},[s("span",[t._v("总BNB")]),t._v(" "),s("span",[t._v("\n        "+t._s(t._f("filterAmount")(t.myVoteInfo.amount))+" BNB\n        "),1==t.myVoteInfo.status?s("i",[t._v("(已赎回)")]):t._e()])]),t._v(" "),s("div",{},[s("span",[t._v("总票数")]),t._v(" "),s("span",[t._v(t._s(t.myVoteInfo.votes))])]),t._v(" "),s("div",{staticClass:"nft-button"},[1!=t.myVoteInfo.status?s("el-button",{attrs:{type:"primary",loading:t.loadings.withdrawtoken,round:"",disabled:3!=t.proposal.status},on:{click:function(e){return t.withdrawToken()}}},[t._v("赎回")]):t._e()],1)])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"part-title"},[e("div",{staticClass:"left-border"}),this._v(" "),e("div",{staticClass:"center-text"},[this._v("我的投票详情")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"arrow-right"},[e("img",{attrs:{src:s("ugyC"),alt:""}})])}]};var _=s("VU/8")(u,m,!1,function(t){s("wPe2")},"data-v-26f4ea7e",null);e.default=_.exports},fxRn:function(t,e,s){s("+tPU"),s("zQR9"),t.exports=s("g8Ux")},g8Ux:function(t,e,s){var i=s("77Pl"),o=s("3fs2");t.exports=s("FeBl").getIterator=function(t){var e=o(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return i(e.call(t))}},ugyC:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAMCAYAAABBV8wuAAAAkUlEQVQoU4WQMQ7DIAxFvxm4Qy/Te2SOgAMxRGLqhNSxE+foHRgjVRkYMgRXpDKiQ1UPXt7/8v8m59yVmZ8hhA3DkDHmoZQ6tNaT934XRtbaCxHdAaxKqXlZlleD1FaDAG5EVMR5AoGjs4PRCWD7DyRErXUtpcxfx5m55JynlNLe44oyxviJ2woCOETZC/56yRsNi1Uw5l97+QAAAABJRU5ErkJggg=="},wPe2:function(t,e){}});
//# sourceMappingURL=7.4782a1aa4d6ec02ef818.js.map