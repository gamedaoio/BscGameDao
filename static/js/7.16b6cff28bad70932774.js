webpackJsonp([7],{BO1k:function(t,e,s){t.exports={default:s("fxRn"),__esModule:!0}},BktS:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s("BO1k"),i=s.n(o),n=s("bOdI"),a=s.n(n),l=s("IcnI"),r=s("oFuF"),v=s("7+uW"),c=l.a.state.contractPath,f=s("tBpT"),u=(s("q+Vb")("./deployments."+c+".json"),{data:function(){var t;return t={myPixelsDialogVisiable:!1,voteDialogVisible:!1,nftVotersDialogVisiable:!1,nftVoters:[],voteNumber:1,voteNft:null,pixelContract:null,voteContract:null,tokenContract:null,myBalance:0,proposalID:"",proposal:{},voteNfts:null},a()(t,"voteNft",null),a()(t,"txs",{}),a()(t,"loadings",{}),a()(t,"myVoteNfts",[]),a()(t,"myVotesDialogVisiable",!1),a()(t,"myVoteInfo",{}),a()(t,"curVoteAmount","0.01"),t},beforeMount:function(){},mounted:function(){this.initContract()},computed:{web3:function(){return this.$store.state.web3}},watch:{web3:function(t,e){this.initContract()},voteNumber:function(t){this.curVoteAmount=Number(this.getVoteAmount(t)).toFixed(4)}},methods:a()({initContract:function(){},getInfo:function(){this.getBnbBalance(),this.checkStateAlive("votesWorks")},getTokenAllowance:function(){var t=this;this.tokenContract.methods.allowance(this.web3.coinbase,this.voteAddress).call({from:this.$store.state.contractFrom}).then(function(e){t.myAllowance=e})},getBnbBalance:function(){var t=this;this.web3.web3Instance().eth.getBalance(this.web3.coinbase).then(function(e){t.myBalance=e})},getTokenBalance:function(){var t=this;this.tokenContract.methods.balanceOf(this.web3.coinbase).call({from:this.$store.state.contractFrom}).then(function(e){t.myBalance=e})},getVoteInfo:function(){var t=this;this.voteContract.methods.proposalID().call().then(function(e){t.proposalId=e,0!=e&&(t.voteContract.methods.proposals(e).call().then(function(e){var s=parseInt(new Date/1e3),o=0,i=0;e.signupTime>s?(i=0,o=e.signupTime-s):e.signupTime<s&&e.voteTime>s?(i=1,o=e.voteTime-s):e.voteTime<s&&e.endTime>s?(i=2,o=e.endTime-s):i=3,e.status=i,e.remainTime=o,e.remainTimeStr=r.a.countdownHour(o),t.proposal=e}),t.voteContract.methods.getProposal(e,t.web3.coinbase,0,0).call().then(function(e){var s=[],o=[];for(var n in e[1]){var a=e[1][n],l=t.getCardType(a.topic),v={id:n,amount:a.amount,nftId:a.nftId,owner:a.owner,topic:l,status:a.status,votes:a.votes,nft:r.a.getPixelInfo(a.nftId)};o.push(a.nftId),s.push(v)}t.voteNfts=s,t.pixelContract.methods.getPixelInfos(o).call({from:t.$store.state.contractFrom}).then(function(e){var o=[],n=!0,a=!1,l=void 0;try{for(var r,v=i()(e);!(n=(r=v.next()).done);n=!0){var c=r.value,f=c.url,u={id:c.id,name:c.name,url:f,mintTime:c.mintTime};o.push(u)}}catch(t){a=!0,l=t}finally{try{!n&&v.return&&v.return()}finally{if(a)throw l}}for(var d=0;d<s.length;d++)s[d].nft=o[d];var m=[];for(var _ in s)s[_].owner.toLowerCase()==t.web3.coinbase.toLowerCase()&&m.push(s[_]);s.sort(function(t,e){return t.votes-e.votes>=0?-1:1}),t.myVoteNfts=m,t.voteNfts=s,t.$store.commit("setVotesWorks",s)})}))})},showNftVotersDialog:function(t){this.nftVotersDialogVisiable=!0,this.nftInfo=t,this.getNftVoters(this.proposalId,this.nftInfo.id)},showMyVotesDialog:function(){this.myVotesDialogVisiable=!0,this.getMyVoter(this.proposalId)},getMyVoter:function(t){var e=this;this.voteContract.methods.getProposalVoter(t,this.web3.coinbase).call().then(function(t){e.myVoteInfo=t})},showMyPixelsDialog:function(){this.myPixelsDialogVisiable=!0},openVotesDialog:function(t){this.voteNft=t,this.voteDialogVisible=!0,this.voteNumber=1,this.curVoteAmount=Number(this.getVoteAmount(this.voteNumber)).toFixed(4),this.getMyVoteNftInfo(this.proposalId,this.voteNft.id)},getMyVoteNftInfo:function(t,e){var s=this;this.voteContract.methods.getProposalNftVoter(t,e,this.web3.coinbase).call().then(function(t){s.voteNft.my=t,s.curVoteAmount=s.getVoteAmount(s.voteNumber)})},getNftVoters:function(t,e){var s=this;this.nftVoters=[],this.voteContract.methods.getProposalNftVoters(t,e,0,0).call().then(function(t){var e=[];for(var o in t[1]){var i=t[1][o],n=t[0][o];n=n.slice(0,4)+"***"+n.slice(-4),e.push({account:n,amount:Number(i.amount/Math.pow(10,18)).toFixed(2),votes:i.votes,rank:0})}for(var o in e.sort(function(t,e){return t.votes-e.votes>0?-1:1}),e)e[o].rank=parseInt(o)+1;s.nftVoters=e})},getVoteAmount:function(t){var e=this.voteNft.my?this.voteNft.my.votes:0;e=parseInt(e),e=0;for(var s=0,o=1;o<=parseInt(t);o++)if(e+o>this.proposal.sqrtVote){var i=e+o-this.proposal.sqrtVote;s+=this.proposal.unitAmount/Math.pow(10,18)/10*i}else s+=this.proposal.unitAmount/Math.pow(10,18);return s},vote:function(t){var e=this.voteNumber,s=(this.voteNft.my&&this.voteNft.my.votes,this.web3.web3Instance().utils.toWei(this.getVoteAmount(e)+""));this.voteConfirm(t,e,s)},approvalVote:function(t,e){this.showLoading(i18n.t("nav.authorizing"));var s=this;this.tokenContract.methods.approve(this.voteAddress,r.a.infinity).send({gasPrice:this.web3.gasPrice}).on("transactionHash",function(t){console.log(t),s.showLoading(i18n.t("nav.authorizeonchain"))}).on("receipt",function(o){console.log(o),s.txs[o.transactionHash]||(s.txs[o.transactionHash]=o.transactionHash,s.hideLoading(),s.$message({message:i18n.t("pixel.authorizesuccess"),type:"info",center:!0}),s.getTokenAllowance(),s.voteConfirm(t,e))}).on("confirmation",function(t,e){console.log(t)}).on("error",function(t){console.log(t),s.hideLoading();var e=t&&t.message?t.message:"";s.$message({message:i18n.t("nav.authorizefailed")+e,type:"error",center:!0})})},voteConfirm:function(t,e,s){var o=this,i=this.proposalId;v.default.set(o.loadings,"vote"+t,!0),console.log(s,i,t),o.voteContract.methods.castVote(i,t,e).estimateGas({from:this.web3.coinbase,value:s},function(n,a){if(n){console.log(n,a);var l=r.a.errMsg(n);return o.$message({message:i18n.t("pixel.votefailed")+l,type:"warning",center:!0}),void v.default.set(o.loadings,"vote"+t,!1)}o.voteContract.methods.castVote(i,t,e).send({gasPrice:o.web3.gasPrice,gas:a,value:s}).on("transactionHash",function(t){console.log("buyConfirm",t),o.$message({message:i18n.t("pixel.voteonchain"),type:"info",center:!0}),o.nftVoteDialogVisiable=!1}).on("receipt",function(e){console.log("buyConfirm",e),o.txs[e.transactionHash]||(o.txs[e.transactionHash]=e.transactionHash,v.default.set(o.loadings,"vote"+t,!1),o.getInfo(),o.$message({message:i18n.t("pixel.votesuccess"),type:"success",center:!0}))}).on("confirmation",function(t,e){console.log("buyConfirm",t)}).on("error",function(e){v.default.set(o.loadings,"vote"+t,!1),o.$message({message:i18n.t("pixel.votefailed")+e.message,type:"warning",center:!0})})})},getCardType:function(t){return f.nfts[t]?f.nfts[t].name.zh:""},checkStateAlive:function(t){this.$store.state[t]?this.voteNfts=this.$store.state[t]:this.getVoteInfo()},closeVotesDialog:function(){this.voteDialogVisible=!1},hideLoading:function(){if(this.loading)return this.loading.close(),void(this.loading=null)},showLoading:function(t){this.loading?this.loading.text=t:this.loading=this.$loading({lock:!0,text:t,spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})}},"closeVotesDialog",function(){this.voteDialogVisible=!1}),filters:{filterTime:function(t){return r.a.formatDate(t,"MM-dd hh:mm")},filterAccount:function(t){return t.slice(0,4)+"***"+t.slice(-4)},filterAmount:function(t){return Number(t/Math.pow(10,18)).toFixed(2)}},beforeDestroy:function(){this.hideLoading()}}),d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"pixel-container"},[s("div",{staticClass:"valid-container"},[t._e(),t._v(" "),s("div",{staticClass:"my-works"},[s("div",{staticClass:"part-title"},[s("div",{staticClass:"left-border"}),t._v(" "),s("div",{staticClass:"center-text"},[t._v(t._s(t.$t("pixel.voterank")))]),t._v(" "),s("div",{staticClass:"more"},[s("span",[s("router-link",{staticStyle:{"text-decoration":"none",color:"#584e5a"},attrs:{to:"/pixel/activity"}},[t._v(t._s(t.$t("pixel.actdetail")))])],1),t._v(" "),t._m(0)])]),t._v(" "),s("div",{staticClass:"works-list"},[t.voteNfts?t._l(t.voteNfts,function(e,o){return s("div",{key:o,staticClass:"work-item"},[s("div",{staticClass:"item-img",style:{backgroundImage:"url("+e.nft.url+")"},on:{click:function(s){return t.showNftVotersDialog(e)}}},[o<3?s("div",{staticClass:"rank-3"},[s("span",[t._v("NO."+t._s(o+1))]),t._v(" "),s("span",{staticClass:"crown"})]):t._e()]),t._v(" "),s("div",{staticClass:"item-name"},[t._v(t._s(e.nft.name))]),t._v(" "),s("div",{staticClass:"item-info"},[s("div",{staticClass:"info-li"},[s("span",[t._v(t._s(t.$t("pixel.creator")))]),t._v(" "),s("span",[t._v(t._s(t._f("filterAccount")(e.owner)))])]),t._v(" "),s("div",{staticClass:"info-li"},[s("span",[t._v(t._s(t.$t("pixel.createtime")))]),t._v(" "),s("span",[t._v(t._s(t._f("filterTime")(e.nft.mintTime)))])]),t._v(" "),s("div",{staticClass:"info-li"},[s("span",[t._v(t._s(t.$t("pixel.votes")))]),t._v(" "),s("span",[t._v(t._s(e.votes))])]),t._v(" "),s("div",{staticClass:"info-li"},[s("span",[t._v("BNB")]),t._v(" "),s("span",[t._v(t._s(t._f("filterAmount")(e.amount)))])])]),t._v(" "),s("div",{staticClass:"item-btn"},[s("el-button",{staticClass:"size gradient",attrs:{round:"",loading:!1},on:{click:function(s){return t.openVotesDialog(e)}}},[t._v(t._s(t.$t("pixel.vote")))])],1)])}):s("div",{staticClass:"round-loader"})],2)]),t._v(" "),s("div",{staticClass:"bottom-tips"},[t._v(t._s(t.$t("pixel.govote")))])]),t._v(" "),t.voteNft?s("el-dialog",{staticClass:"votes-dialog",attrs:{visible:t.voteDialogVisible,title:t.$t("pixel.vote"),width:"40","modal-append-to-body":!1},on:{"update:visible":function(e){t.voteDialogVisible=e}}},[s("div",{staticClass:"nft-img",style:{backgroundImage:"url("+t.voteNft.nft.url+")"}},[s("div",{staticClass:"nft-name"},[t._v(t._s(t.voteNft.nft.name)+"|"+t._s(t.voteNft.topic))])]),t._v(" "),s("div",{staticClass:"votes-input"},[s("span",[t._v(t._s(t.$t("pixel.votesnow")))]),t._v(" "),s("span",[t._v(t._s(t.voteNft.votes))])]),t._v(" "),s("div",{staticClass:"votes-input"},[s("span",[t._v(t._s(t.$t("pixel.voted")))]),t._v(" "),s("span",[t._v(t._s(t.voteNft.my?t.voteNft.my.votes:0))])]),t._v(" "),s("div",{staticClass:"votes-input"},[s("span",[t._v(t._s(t.$t("pixel.bnbvoted")))]),t._v(" "),s("span",[t._v(t._s(t._f("filterAmount")(t.voteNft.my?t.voteNft.my.amount:0))+"BNB")])]),t._v(" "),s("div",{staticClass:"votes-input"},[s("span",[t._v(t._s(t.$t("pixel.votenum")))]),t._v(" "),s("el-input-number",{attrs:{min:0},model:{value:t.voteNumber,callback:function(e){t.voteNumber=e},expression:"voteNumber"}})],1),t._v(" "),s("div",{staticClass:"votes-input"},[s("span",[t._v(t._s(t.$t("pixel.needbnbnum")))]),t._v(" "),s("span",[t._v(t._s(t.curVoteAmount)+"BNB")])]),t._v(" "),s("div",{staticClass:"votes-input"},[s("span",[t._v(t._s(t.$t("common.balance")))]),t._v(" "),s("span",[t._v(t._s(t._f("filterAmount")(t.myBalance)))])]),t._v(" "),s("div",{staticClass:"votes-btn"},[s("el-button",{staticClass:"size gradient",attrs:{round:"",loading:t.loadings["vote"+t.voteNft.id]},on:{click:function(e){return t.vote(t.voteNft.id)}}},[t._v(t._s(t.$t("pixel.confirmvote")))])],1),t._v(" "),s("div",{staticClass:"votes-tips"},[t._v(t._s(t.$t("pixel.countmethod")))]),t._v(" "),s("div",{staticClass:"close-btn",on:{click:function(e){return t.closeVotesDialog()}}},[t._v(t._s(t.$t("pixel.cancelvote")))])]):t._e(),t._v(" "),s("el-dialog",{attrs:{title:t.$t("pixel.votedetail"),visible:t.nftVotersDialogVisiable},on:{"update:visible":function(e){t.nftVotersDialogVisiable=e}}},[s("div",{staticClass:"vote-detail-body"},[s("div",{staticClass:"table-head"},[s("div",{staticClass:"table-item"},[t._v(t._s(t.$t("collect.rank")))]),t._v(" "),s("div",{staticClass:"table-item"},[t._v(t._s(t.$t("common.account")))]),t._v(" "),s("div",{staticClass:"table-item"},[t._v(t._s(t.$t("pixel.votes")))]),t._v(" "),s("div",{staticClass:"table-item"},[t._v("BNB")])]),t._v(" "),s("div",{staticClass:"table-body"},[s("div",{staticClass:"table-content"},t._l(t.nftVoters,function(e){return s("div",{staticClass:"table-row"},[s("div",{staticClass:"table-item"},[t._v(t._s(e.rank))]),t._v(" "),s("div",{staticClass:"table-item"},[t._v(t._s(e.account))]),t._v(" "),s("div",{staticClass:"table-item"},[t._v(t._s(e.votes))]),t._v(" "),s("div",{staticClass:"table-item"},[t._v(t._s(e.amount))])])}),0)])])]),t._v(" "),s("el-dialog",{attrs:{title:t.$t("pixel.myworks"),visible:t.myPixelsDialogVisiable,center:""},on:{"update:visible":function(e){t.myPixelsDialogVisiable=e}}},[s("div",{staticClass:"nfts-box"},[s("div",{staticClass:"nft-items"},t._l(t.myVoteNfts,function(e){return s("div",{staticClass:"nft-item"},[s("div",{staticClass:"nft-img"},[s("img",{attrs:{src:e.nft.url}})]),t._v(" "),s("div",{staticClass:"nft-info"},[s("div",{staticClass:"nft-name"},[t._v(t._s(e.nft.name))]),t._v(" "),s("div",{staticClass:"nft-owner"},[s("span",[t._v(t._s(t.$t("pixel.topic")))]),t._v(" "),s("span",[t._v(t._s(e.topic))])]),t._v(" "),s("div",{staticClass:"nft-votes"},[s("span",[t._v(t._s(t.$t("pixel.votes")))]),t._v(" "),s("span",[t._v(t._s(e.votes))])]),t._v(" "),s("div",{staticClass:"nft-amount"},[s("span",[t._v("BNB")]),t._v(" "),s("span",[t._v(t._s(t._f("filterAmount")(e.amount))+" BNB")])]),t._v(" "),s("div",{staticClass:"nft-button"},[1!=e.status?s("el-button",{attrs:{type:"primary",loading:t.loadings["withdrawnft"+e.id],disabled:3!=t.proposal.status},on:{click:function(s){return t.withdrawNft(e.id)}}},[t._v(t._s(t.$t("farm.redeem")))]):t._e()],1),t._v(" "),1==e.status?s("div",{staticStyle:{"text-align":"center",display:"block"}},[t._v(t._s(t.$t("pixel.redeemed")))]):t._e()])])}),0)])]),t._v(" "),s("el-dialog",{attrs:{title:t.$t("pixel.myvote"),visible:t.myVotesDialogVisiable,center:""},on:{"update:visible":function(e){t.myVotesDialogVisiable=e}}},[s("div",{},[s("span",[t._v(t._s(t.$t("pixel.total"))+"BNB")]),t._v(" "),s("span",[t._v("\n        "+t._s(t._f("filterAmount")(t.myVoteInfo.amount))+" BNB\n        "),1==t.myVoteInfo.status?s("i",[t._v("("+t._s(t.$t("pixel.redeemed"))+")")]):t._e()])]),t._v(" "),s("div",{},[s("span",[t._v(t._s(t.$t("pixel.totalvotes")))]),t._v(" "),s("span",[t._v(t._s(t.myVoteInfo.votes))])]),t._v(" "),s("div",{staticClass:"nft-button"},[1!=t.myVoteInfo.status?s("el-button",{attrs:{type:"primary",loading:t.loadings.withdrawtoken,round:"",disabled:3!=t.proposal.status},on:{click:function(e){return t.withdrawToken()}}},[t._v(t._s(t.$t("farm.redeem")))]):t._e()],1)])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"arrow-right"},[e("img",{attrs:{src:s("ugyC"),alt:""}})])}]};var m=s("VU/8")(u,d,!1,function(t){s("xnqG")},"data-v-2243cf21",null);e.default=m.exports},fxRn:function(t,e,s){s("+tPU"),s("zQR9"),t.exports=s("g8Ux")},g8Ux:function(t,e,s){var o=s("77Pl"),i=s("3fs2");t.exports=s("FeBl").getIterator=function(t){var e=i(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return o(e.call(t))}},ugyC:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAMCAYAAABBV8wuAAAAkUlEQVQoU4WQMQ7DIAxFvxm4Qy/Te2SOgAMxRGLqhNSxE+foHRgjVRkYMgRXpDKiQ1UPXt7/8v8m59yVmZ8hhA3DkDHmoZQ6tNaT934XRtbaCxHdAaxKqXlZlleD1FaDAG5EVMR5AoGjs4PRCWD7DyRErXUtpcxfx5m55JynlNLe44oyxviJ2woCOETZC/56yRsNi1Uw5l97+QAAAABJRU5ErkJggg=="},xnqG:function(t,e){}});
//# sourceMappingURL=7.16b6cff28bad70932774.js.map