webpackJsonp([7],{BO1k:function(t,e,s){t.exports={default:s("fxRn"),__esModule:!0}},BktS:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s("BO1k"),i=s.n(o),n=s("bOdI"),a=s.n(n),r=s("IcnI"),l=s("oFuF"),c=s("7+uW"),v=r.a.state.contractPath,f=s("q+Vb")("./deployments."+v+".json"),u=s("tBpT"),d={data:function(){var t;return t={voteDialogVisible:!1,voteNum:0,voteNft:null,pixelContract:null,voteContract:null,tokenContract:null,myBalance:0,proposalID:"",proposal:{},voteNfts:null},a()(t,"voteNft",null),a()(t,"txs",{}),a()(t,"loadings",{}),t},beforeMount:function(){},mounted:function(){this.initContract()},computed:{web3:function(){return this.$store.state.web3}},watch:{web3:function(t,e){this.initContract()}},methods:a()({initContract:function(){if(this.web3&&this.web3.web3Instance&&!this.pixelContract){var t=this.web3.web3Instance();this.pixelAddress=f.Pixel.address,this.pixelContract=new t.eth.Contract(f.Pixel.abi,f.Pixel.address,{from:this.web3.coinbase}),this.voteAddress=f.PixelVote.address,this.voteContract=new t.eth.Contract(f.PixelVote.abi,f.PixelVote.address,{from:this.web3.coinbase}),this.getInfo()}},getInfo:function(){this.checkStateAlive("votesWorks")},getTokenAllowance:function(){var t=this;this.tokenContract.methods.allowance(this.web3.coinbase,this.voteAddress).call({from:this.$store.state.contractFrom}).then(function(e){t.myAllowance=e})},getTokenBalance:function(){var t=this;this.tokenContract.methods.balanceOf(this.web3.coinbase).call({from:this.$store.state.contractFrom}).then(function(e){t.myBalance=e})},getVoteInfo:function(){var t=this;this.voteContract.methods.proposalID().call().then(function(e){t.proposalId=e,0!=e&&(t.voteContract.methods.proposals(e).call().then(function(e){var s=parseInt(new Date/1e3),o=0,i=0;e.signupTime>s?(i=0,o=e.signupTime-s):e.signupTime<s&&e.voteTime>s?(i=1,o=e.voteTime-s):e.voteTime<s&&e.endTime>s?(i=2,o=e.endTime-s):i=3,e.status=i,e.remainTime=o,e.remainTimeStr=l.a.countdownHour(o),t.proposal=e}),t.voteContract.methods.getProposal(e,t.web3.coinbase,0,0).call().then(function(e){var s=[],o=[];for(var n in e[1]){var a=e[1][n],r=t.getCardType(a.topic),c={id:n,amount:a.amount,nftId:a.nftId,owner:a.owner,topic:r,status:a.status,votes:a.votes,nft:l.a.getPixelInfo(a.nftId)};o.push(a.nftId),s.push(c)}t.pixelContract.methods.getPixelInfos(o).call({from:t.$store.state.contractFrom}).then(function(e){var o=[],n=!0,a=!1,r=void 0;try{for(var l,c=i()(e);!(n=(l=c.next()).done);n=!0){var v=l.value,f=v.url,u={id:v.id,name:v.name,url:f,mintTime:v.mintTime};o.push(u)}}catch(t){a=!0,r=t}finally{try{!n&&c.return&&c.return()}finally{if(a)throw r}}for(var d=0;d<s.length;d++)s[d].nft=o[d];var h=[];for(var m in s)s[m].owner.toLowerCase()==t.web3.coinbase.toLowerCase()&&h.push(s[m]);s.sort(function(t,e){return t.votes-e.votes>=0?-1:1}),t.myVoteNfts=h,t.voteNfts=s,t.$store.commit("setVotesWorks",s)})}))})},getCardType:function(t){return u.nfts[t]?u.nfts[t].name.zh:""},showMyVotesDialog:function(){this.myVotesDialogVisiable=!0,this.getMyVoter(this.proposalId)},getMyVoter:function(t){var e=this;this.voteContract.methods.getProposalVoter(t,this.web3.coinbase).call().then(function(t){e.myVoteInfo=t})},openVotesDialog:function(t){this.voteNft=t,this.voteDialogVisible=!0,this.getMyVoteNftInfo(this.proposalId,this.voteNft.id)},getMyVoteNftInfo:function(t,e){var s=this;this.voteContract.methods.getProposalNftVoter(t,e,this.web3.coinbase).call().then(function(t){s.voteNft.my=t,s.voteAmount=s.getVoteAmount(s.voteNumber)})},getNftVoters:function(t,e){var s=this;this.nftVoters=[],this.voteContract.methods.getProposalNftVoters(t,e,0,0).call().then(function(t){var e=[];for(var o in t[1]){var i=t[1][o],n=t[0][o];n=n.slice(0,4)+"***"+n.slice(-4),e.push({account:n,amount:Number(i.amount/Math.pow(10,18)).toFixed(2),votes:i.votes,rank:0})}for(var o in e.sort(function(t,e){return t.votes-e.votes>0?-1:1}),e)e[o].rank=parseInt(o)+1;s.nftVoters=e})},getVoteAmount:function(t){var e=this.voteNft.my?this.voteNft.my.votes:0;e=parseInt(e),e=0;for(var s=0,o=1;o<=parseInt(t);o++)if(e+o>this.proposal.sqrtVote){var i=e+o-this.proposal.sqrtVote;s+=this.proposal.unitAmount/Math.pow(10,18)/10*i}else s+=this.proposal.unitAmount/Math.pow(10,18);return s},vote:function(t){var e=this.voteNum,s=(this.voteNft.my&&this.voteNft.my.votes,this.web3.web3Instance().utils.toWei(this.getVoteAmount(e)+""));l.a.compareTo(this.myAllowance,s)<0?this.approvalVote(t,e):this.voteConfirm(t,e)},approvalVote:function(t,e){this.showLoading(i18n.t("nav.authorizing"));var s=this;this.tokenContract.methods.approve(this.voteAddress,l.a.infinity).send({gasPrice:this.web3.gasPrice}).on("transactionHash",function(t){console.log(t),s.showLoading(i18n.t("nav.authorizeonchain"))}).on("receipt",function(o){console.log(o),s.txs[o.transactionHash]||(s.txs[o.transactionHash]=o.transactionHash,s.hideLoading(),s.$message({message:i18n.t("pixel.authorizesuccess"),type:"info",center:!0}),s.getTokenAllowance(),s.voteConfirm(t,e))}).on("confirmation",function(t,e){console.log(t)}).on("error",function(t){console.log(t),s.hideLoading();var e=t&&t.message?t.message:"";s.$message({message:i18n.t("nav.authorizefailed")+e,type:"error",center:!0})})},voteConfirm:function(t,e){var s=this,o=this.proposalId;c.default.set(s.loadings,"vote"+t,!0),s.voteContract.methods.castVote(o,t,e).estimateGas({from:this.web3.coinbase},function(i,n){if(i){console.log(i,n);var a=l.a.errMsg(i);return s.$message({message:"投票失败"+a,type:"warning",center:!0}),void c.default.set(s.loadings,"vote"+t,!1)}s.voteContract.methods.castVote(o,t,e).send({gasPrice:s.web3.gasPrice,gas:n}).on("transactionHash",function(t){console.log("buyConfirm",t),s.$message({message:i18n.t("pixel.voteonchain"),type:"info",center:!0}),s.nftVoteDialogVisiable=!1}).on("receipt",function(e){console.log("buyConfirm",e),s.txs[e.transactionHash]||(s.txs[e.transactionHash]=e.transactionHash,c.default.set(s.loadings,"vote"+t,!1),s.getInfo(),s.$message({message:i18n.t("pixel.votesuccess"),type:"success",center:!0}))}).on("confirmation",function(t,e){console.log("buyConfirm",t)}).on("error",function(e){c.default.set(s.loadings,"vote"+t,!1),s.$message({message:i18n.t("pixel.votefailed")+e.message,type:"warning",center:!0})})})},checkStateAlive:function(t){this.$store.state[t]?this.voteNfts=this.$store.state[t]:this.getVoteInfo()},closeVotesDialog:function(){this.voteDialogVisible=!1},hideLoading:function(){if(this.loading)return this.loading.close(),void(this.loading=null)},showLoading:function(t){this.loading?this.loading.text=t:this.loading=this.$loading({lock:!0,text:t,spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})}},"closeVotesDialog",function(){this.voteDialogVisible=!1}),filters:{filterTime:function(t){return l.a.formatDate(t,"MM-dd hh:mm")},filterAccount:function(t){return t.slice(0,4)+"***"+t.slice(-4)},filterAmount:function(t){return Number(t/Math.pow(10,18)).toFixed(2)}},beforeDestroy:function(){this.hideLoading()}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"pixel-container"},[s("div",{staticClass:"valid-container"},[s("div",{staticClass:"votes-detail"},[t._m(0),t._v(" "),s("div",{staticClass:"my-votes-info"},[s("div",{staticClass:"account-info"},[t._m(1),t._v(" "),s("div",{staticClass:"my-coinbase"},[t._v("0xd4***07e")]),t._v(" "),s("el-button",{staticClass:"gradient resteek",attrs:{round:"",loading:!1}},[t._v("赎 回")])],1),t._v(" "),t._m(2)])]),t._v(" "),s("div",{staticClass:"my-works"},[s("div",{staticClass:"part-title"},[s("div",{staticClass:"left-border"}),t._v(" "),s("div",{staticClass:"center-text"},[t._v(t._s(t.$t("pixel.voterank")))]),t._v(" "),s("div",{staticClass:"more"},[s("span",[s("router-link",{staticStyle:{"text-decoration":"none",color:"#584e5a"},attrs:{to:"/pixel/activity"}},[t._v(t._s(t.$t("pixel.actdetail")))])],1),t._v(" "),t._m(3)])]),t._v(" "),s("div",{staticClass:"works-list"},[t.voteNfts?t._l(t.voteNfts,function(e,o){return s("div",{key:o,staticClass:"work-item"},[s("div",{staticClass:"item-img",style:{backgroundImage:"url("+e.nft.url+")"}},[o<3?s("div",{staticClass:"rank-3"},[s("span",[t._v("NO."+t._s(o+1))]),t._v(" "),s("span",{staticClass:"crown"})]):t._e()]),t._v(" "),s("div",{staticClass:"item-name"},[t._v(t._s(e.nft.name))]),t._v(" "),s("div",{staticClass:"item-info"},[s("div",{staticClass:"info-li"},[s("span",[t._v(t._s(t.$t("pixel.creator")))]),t._v(" "),s("span",[t._v(t._s(t._f("filterAccount")(e.owner)))])]),t._v(" "),s("div",{staticClass:"info-li"},[s("span",[t._v(t._s(t.$t("pixel.createtime")))]),t._v(" "),s("span",[t._v("05-22 15:51")])]),t._v(" "),s("div",{staticClass:"info-li"},[s("span",[t._v(t._s(t.$t("pixel.votes")))]),t._v(" "),s("span",[t._v(t._s(e.votes))])]),t._v(" "),s("div",{staticClass:"info-li"},[s("span",[t._v("GDT")]),t._v(" "),s("span",[t._v(t._s(t._f("filterAmount")(e.amount))+"GDT")])])]),t._v(" "),s("div",{staticClass:"item-btn"},[s("el-button",{staticClass:"size gradient",attrs:{round:"",loading:!1},on:{click:function(s){return t.openVotesDialog(e)}}},[t._v(t._s(t.$t("pixel.vote")))])],1)])}):s("div",{staticClass:"round-loader"})],2)]),t._v(" "),s("div",{staticClass:"bottom-tips"},[t._v(t._s(t.$t("pixel.govote")))])]),t._v(" "),t.voteNft?s("el-dialog",{staticClass:"votes-dialog",attrs:{visible:t.voteDialogVisible,title:t.$t("pixel.vote"),width:"40","modal-append-to-body":!1},on:{"update:visible":function(e){t.voteDialogVisible=e}}},[s("div",{staticClass:"nft-img",style:{backgroundImage:"url("+t.voteNft.nft.url+")"}},[s("div",{staticClass:"nft-name"},[t._v(t._s(t.voteNft.topic))])]),t._v(" "),s("div",{staticClass:"nft-info"},[s("div",{staticClass:"info-list"},[s("div",{staticClass:"devide"},[s("span",[t._v(t._s(t.$t("pixel.votesnow")))]),t._v(" "),s("span",[t._v(t._s(t.voteNft.votes))])]),t._v(" "),s("div",{staticClass:"devide"},[s("span",[t._v(t._s(t.$t("pixel.voted")))]),t._v(" "),s("span",[t._v(t._s(t.voteNft.my?t.voteNft.my.votes:0))])])]),t._v(" "),s("div",{staticClass:"info-list"},[s("div",{staticClass:"devide"},[s("span",[t._v(t._s(t.$t("pixel.gdtvoted")))]),t._v(" "),s("span",[t._v(t._s(t._f("filterAmount")(t.voteNft.my?t.voteNft.my.amount:0))+"GDT")])]),t._v(" "),s("div",{staticClass:"devide"},[s("span",[t._v(t._s(t.$t("common.balance")))]),t._v(" "),s("span",[t._v(t._s(t._f("filterAmount")(t.myBalance)))])])])]),t._v(" "),s("div",{staticClass:"votes-input"},[s("span",[t._v(t._s(t.$t("pixel.votenum")))]),t._v(" "),s("el-input-number",{attrs:{min:0},model:{value:t.voteNum,callback:function(e){t.voteNum=e},expression:"voteNum"}})],1),t._v(" "),s("div",{staticClass:"votes-tips"},[t._v(t._s(t.$t("pixel.countmethod")))]),t._v(" "),s("div",{staticClass:"votes-btn"},[s("el-button",{staticClass:"size gradient",attrs:{round:"",loading:!1},on:{click:function(e){return t.vote(t.voteNft.id)}}},[t._v(t._s(t.$t("pixel.confirmvote")))])],1),t._v(" "),s("div",{staticClass:"close-btn",on:{click:function(e){return t.closeVotesDialog()}}},[t._v("\n      "+t._s(t.$t("pixel.cancelvote"))+"\n    ")])]):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"part-title"},[e("div",{staticClass:"left-border"}),this._v(" "),e("div",{staticClass:"center-text"},[this._v("投票详情")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"gamedao-icon"},[e("img",{attrs:{src:s("/cix"),alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"template"},[e("div",{staticClass:"total-votes"},[e("div",{staticClass:"title"},[this._v("我的总票数")]),this._v(" "),e("div",{staticClass:"number"},[this._v("146302")])]),this._v(" "),e("div",{staticClass:"total-bnb"},[e("div",{staticClass:"title"},[this._v("我的BNB")]),this._v(" "),e("div",{staticClass:"number"},[this._v("1463")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"arrow-right"},[e("img",{attrs:{src:s("ugyC"),alt:""}})])}]};var m=s("VU/8")(d,h,!1,function(t){s("eU03")},"data-v-036b4e8c",null);e.default=m.exports},eU03:function(t,e){},fxRn:function(t,e,s){s("+tPU"),s("zQR9"),t.exports=s("g8Ux")},g8Ux:function(t,e,s){var o=s("77Pl"),i=s("3fs2");t.exports=s("FeBl").getIterator=function(t){var e=i(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return o(e.call(t))}},ugyC:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAMCAYAAABBV8wuAAAAkUlEQVQoU4WQMQ7DIAxFvxm4Qy/Te2SOgAMxRGLqhNSxE+foHRgjVRkYMgRXpDKiQ1UPXt7/8v8m59yVmZ8hhA3DkDHmoZQ6tNaT934XRtbaCxHdAaxKqXlZlleD1FaDAG5EVMR5AoGjs4PRCWD7DyRErXUtpcxfx5m55JynlNLe44oyxviJ2woCOETZC/56yRsNi1Uw5l97+QAAAABJRU5ErkJggg=="}});
//# sourceMappingURL=7.5ec2f62715d375a233ba.js.map