webpackJsonp([12],{"/pqJ":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("oFuF"),o=s("IcnI"),n=s("7+uW"),a=s("qoVm"),l=o.a.state.contractPath,r=s("q+Vb")("./deployments."+l+".json"),c=s("tBpT"),p={data:function(){return{pixelContract:null,voteContract:null,mynfts:[],joinVoteNft:null,joinVoteVisible:!1,nftCards:[],selectTopic:"",proposal:{},loadings:{}}},beforeMount:function(){var t=[];for(var e in c.nfts){var s=c.nfts[e];105!=s.id&&t.push({name:s.name.zh,value:s.id})}this.nftCards=t},mounted:function(){this.initContract()},computed:{web3:function(){return this.$store.state.web3}},watch:{web3:function(t,e){this.initContract()}},methods:{initContract:function(){if(this.web3&&this.web3.web3Instance&&!this.pixelContract){var t=this.web3.web3Instance();this.pixelAddress=r.Pixel.address,this.pixelContract=new t.eth.Contract(r.Pixel.abi,r.Pixel.address,{from:this.web3.coinbase}),this.voteAddress=r.PixelVote.address,this.voteContract=new t.eth.Contract(r.PixelVote.abi,r.PixelVote.address,{from:this.web3.coinbase}),this.getInfo()}},getInfo:function(){this.getCurProposal(),this.getMyWorks()},getMyWorks:function(){this.checkStateAlive("pixelWorks")},getMyPixelWorks:function(){var t=this;this.pixelContract.methods.balanceOf(this.web3.coinbase).call({from:this.$store.state.contractFrom}).then(function(e){t.myNftBalance=e,console.log("myNftBalance balanceOf",e),0!=e&&t.pixelContract.methods.tokensOf(t.web3.coinbase,0,e).call({from:t.$store.state.contractFrom}).then(function(e){var s=[];console.log("tokensOf",e),e.length>0&&t.pixelContract.methods.getPixelInfos(e).call({from:t.$store.state.contractFrom}).then(function(e){console.log("token infos:",e),e.forEach(function(t){var e={id:t[0],name:t[1],url:t[2],mintdate:t[3]};s.push(e)}),t.mynfts=s,t.$store.commit("setPixelWorks",s),console.log(t.$store.state.pixelWorks)})})})},getCurProposal:function(){var t=this;this.voteContract.methods.proposalID().call().then(function(e){t.proposalId=e,0!=e&&t.voteContract.methods.proposals(e).call().then(function(e){var s=parseInt(new Date/1e3),o=0,n=0;e.signupTime>s?(n=0,o=e.signupTime-s):e.signupTime<s&&e.voteTime>s?(n=1,o=e.voteTime-s):e.voteTime<s&&e.endTime>s?(n=2,o=e.endTime-s):n=3,e.status=n,e.remainTime=o,e.remainTimeStr=i.a.countdownHour(o),t.proposal=e})})},toWall:function(t){var e=this.joinVoteNft.id,s=this.selectTopic;if(s>0&&s<=104){var o=this.voteAddress,l=this;n.default.set(l.loadings,"publish"+e,!0);var r=this.proposalId,c="0x";for(r=i.a.toBigInteger(r).toString(16);r.length<64;)r="0"+r;for(c+=r,s=i.a.toBigInteger(s).toString(16);s.length<64;)s="0"+s;c+=s,this.pixelContract.methods.safeTransferFrom(this.web3.coinbase,o,e,c).estimateGas({from:this.web3.coinbase},function(t,s){if(t){console.log(t,s);var r=i.a.errMsg(t);return l.$message({message:a.a.t("pixel.publishfailed")+r,type:"warning",center:!0}),void n.default.set(l.loadings,"publish"+e,!1)}l.pixelContract.methods.safeTransferFrom(l.web3.coinbase,o,e,c).send({gasPrice:l.web3.gasPrice,gas:s}).on("transactionHash",function(t){console.log(t),l.$message({message:a.a.t("pixel.publishconfirm"),type:"info",center:!0})}).on("receipt",function(t){console.log(t),l.txs[t.transactionHash]||(l.txs[t.transactionHash]=t.transactionHash,n.default.set(l.loadings,"publish"+e,!1),l.getInfo(),l.$message({message:a.a.t("pixel.publishsuccess"),type:"success",center:!0}))}).on("confirmation",function(t,e){console.log(t)}).on("error",function(t){console.log(t),n.default.set(l.loadings,"publish"+e,!1);var s=t&&t.message?t.message:"";l.$message({message:a.a.t("pixel.publishfailed")+s,type:"error",center:!0})})})}else this.$message({message:a.a.t("pixel.selecttopic"),type:"warning",center:!0})},showWorksJoin:function(t){this.joinVoteVisible=!0,this.joinVoteNft=t},checkStateAlive:function(t){this.$store.state[t]?this.mynfts=this.$store.state[t]:this.getMyPixelWorks()}},beforeDestroy:function(){},filters:{}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"pixel-container"},[i("div",{staticClass:"valid-container"},[i("div",{staticClass:"my-works"},[i("div",{staticClass:"part-title"},[i("div",{staticClass:"left-border"}),t._v(" "),i("div",{staticClass:"center-text"},[t._v(t._s(t.$t("pixel.myworks")))])]),t._v(" "),i("div",{staticClass:"works-list"},t._l(t.mynfts,function(e,s){return i("div",{key:s,staticClass:"work-item"},[i("div",{staticClass:"item-img",style:{backgroundImage:"url("+e.url+")"}}),t._v(" "),i("div",{staticClass:"item-info"},[i("span",[t._v(t._s(e.name))]),t._v(" "),i("span",[t._v("05-22 15:51")])]),t._v(" "),i("div",{staticClass:"item-btn"},[i("el-button",{staticClass:"gradient size",attrs:{round:"",loading:!1},on:{click:function(s){return t.showWorksJoin(e)}}},[t._v(t._s(t.$t("pixel.joinvote")))])],1)])}),0),t._v(" "),i("div",{staticClass:"bottom-tips"},[t._v(t._s(t.$t("pixel.gocreate")))])])]),t._v(" "),t.joinVoteNft?i("el-dialog",{attrs:{title:t.$t("pixel.publish"),visible:t.joinVoteVisible,center:"","modal-append-to-body":!1},on:{"update:visible":function(e){t.joinVoteVisible=e}}},[i("div",{staticClass:"join-box"},[i("div",{staticClass:"topic-select"},[i("div",{staticClass:"label"},[t._v(t._s(t.$t("pixel.relatetopic")))]),t._v(" "),i("div",{staticClass:"input"},[i("el-select",{attrs:{placeholder:t.$t("pixel.selecttopic")},model:{value:t.selectTopic,callback:function(e){t.selectTopic=e},expression:"selectTopic"}},t._l(t.nftCards,function(t){return i("el-option",{key:t.value,attrs:{label:t.name,value:t.value}})}),1)],1)]),t._v(" "),i("div",{staticClass:"tips"},[i("span",{staticClass:"vote-title"},[t._v(t._s(t.proposal.name))]),t._v(" "),0==t.proposal.status?i("span",[t._v(t._s(t.$t("pixel.beforeact"))+t._s(t.proposal.remainTimeStr))]):t._e(),t._v(" "),1==t.proposal.status?i("span",[t._v(t._s(t.$t("pixel.inact"))+t._s(t.proposal.remainTimeStr))]):t._e(),t._v(" "),2==t.proposal.status?i("span",[t._v(t._s(t.$t("pixel.beforevote"))+t._s(t.proposal.remainTimeStr))]):t._e(),t._v(" "),3==t.proposal.status?i("span",[t._v(t._s(t.$t("pixel.afteract")))]):t._e()]),t._v(" "),i("el-button",{staticClass:"gradient size",attrs:{round:"",loading:t.loadings["publish"+t.joinVoteNft.id]},on:{click:function(e){return t.toWall()}}},[t._v(t._s(t.$t("common.confirm")))]),t._v(" "),i("div",{staticClass:"close-btn"},[i("div",{staticClass:"icon",on:{click:function(e){t.joinVoteVisible=!1}}},[i("img",{attrs:{src:s("ScAH"),alt:"close"}})])])],1)]):t._e()],1)},staticRenderFns:[]};var f=s("VU/8")(p,u,!1,function(t){s("UkWm")},"data-v-2f78a74a",null);e.default=f.exports},UkWm:function(t,e){}});
//# sourceMappingURL=12.a80b6fa44c3301ea5034.js.map