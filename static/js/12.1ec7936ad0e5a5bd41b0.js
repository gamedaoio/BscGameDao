webpackJsonp([12],{"/pqJ":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("oFuF"),o=s("IcnI"),a=s("7+uW"),n=s("qoVm"),r=o.a.state.contractPath,l=s("q+Vb")("./deployments."+r+".json"),c=s("tBpT"),p={data:function(){return{txs:{},pixelContract:null,voteContract:null,mynfts:[],joinVoteNft:null,joinVoteVisible:!1,nftCards:[],selectTopic:"",proposal:{},loadings:{}}},beforeMount:function(){var t=[];for(var e in c.nfts){var s=c.nfts[e];105!=s.id&&t.push({name:s.name.zh,value:s.id})}this.nftCards=t},mounted:function(){this.initContract()},computed:{web3:function(){return this.$store.state.web3}},watch:{web3:function(t,e){this.initContract()}},methods:{initContract:function(){if(this.web3&&this.web3.web3Instance&&!this.pixelContract){var t=this.web3.web3Instance();this.pixelAddress=l.Pixel.address,this.pixelContract=new t.eth.Contract(l.Pixel.abi,l.Pixel.address,{from:this.web3.coinbase}),this.voteAddress=l.PixelVote.address,this.voteContract=new t.eth.Contract(l.PixelVote.abi,l.PixelVote.address,{from:this.web3.coinbase}),this.getInfo()}},getInfo:function(){this.getCurProposal(),this.getMyWorks()},getMyWorks:function(){this.checkStateAlive("pixelWorks")},getMyPixelWorks:function(){var t=this;this.pixelContract.methods.balanceOf(this.web3.coinbase).call({from:this.$store.state.contractFrom}).then(function(e){t.myNftBalance=e,console.log("myNftBalance balanceOf",e),0!=e&&t.pixelContract.methods.tokensOf(t.web3.coinbase,0,e).call({from:t.$store.state.contractFrom}).then(function(e){var s=[];console.log("tokensOf",e),e.length>0&&t.pixelContract.methods.getPixelInfos(e).call({from:t.$store.state.contractFrom}).then(function(e){console.log("token infos:",e),e.forEach(function(t){var e={id:t[0],name:t[1],url:t[2],mintdate:t[3]};s.push(e)}),t.mynfts=s,t.$store.commit("setPixelWorks",s),console.log(t.$store.state.pixelWorks)})})})},getCurProposal:function(){var t=this;this.voteContract.methods.proposalID().call().then(function(e){t.proposalId=e,0!=e&&t.voteContract.methods.proposals(e).call().then(function(e){var s=parseInt(new Date/1e3),o=0,a=0;e.signupTime>s?(a=0,o=e.signupTime-s):e.signupTime<s&&e.voteTime>s?(a=1,o=e.voteTime-s):e.voteTime<s&&e.endTime>s?(a=2,o=e.endTime-s):a=3,e.status=a,e.remainTime=o,e.remainTimeStr=i.a.countdownHour(o),t.proposal=e})})},toUTF8Array:function(t){for(var e=[],s=0;s<t.length;s++){var i=t.charCodeAt(s);i<128?e.push(i):i<2048?e.push(192|i>>6,128|63&i):i<55296||i>=57344?e.push(224|i>>12,128|i>>6&63,128|63&i):(s++,i=65536+((1023&i)<<10|1023&t.charCodeAt(s)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return e},utf8to16:function(t){var e,s,i,o,a,n;for(e="",i=t.length,s=0;s<i;)switch((o=t.charCodeAt(s++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=t.charAt(s-1);break;case 12:case 13:a=t.charCodeAt(s++),e+=String.fromCharCode((31&o)<<6|63&a);break;case 14:a=t.charCodeAt(s++),n=t.charCodeAt(s++),e+=String.fromCharCode((15&o)<<12|(63&a)<<6|(63&n)<<0)}return e},toWall:function(t){var e=this.joinVoteNft.id,s=this.selectTopic;if(0!=s){console.log(s);var o=this.voteAddress,r=this;a.default.set(r.loadings,"publish"+e,!0);var l=this.proposalId,c="0x";for(l=i.a.toBigInteger(l).toString(16);l.length<64;)l="0"+l;for(c+=l,s=i.a.toBigInteger(s).toString(16);s.length<64;)s="0"+s;c+=s,console.log(c),this.pixelContract.methods.safeTransferFrom(this.web3.coinbase,o,e,c).estimateGas({from:this.web3.coinbase},function(t,s){if(t){console.log(t,s);var l=i.a.errMsg(t);return r.$message({message:n.a.t("pixel.publishfailed")+l,type:"warning",center:!0}),void a.default.set(r.loadings,"publish"+e,!1)}r.pixelContract.methods.safeTransferFrom(r.web3.coinbase,o,e,c).send({gasPrice:r.web3.gasPrice,gas:s}).on("transactionHash",function(t){console.log(t),r.joinVoteVisible=!1,r.$message({message:n.a.t("pixel.publishconfirm"),type:"info",center:!0})}).on("receipt",function(t){console.log(t),r.txs[t.transactionHash]||(r.txs[t.transactionHash]=t.transactionHash,a.default.set(r.loadings,"publish"+e,!1),r.getInfo(),r.$message({message:n.a.t("pixel.publishsuccess"),type:"success",center:!0}))}).on("confirmation",function(t,e){console.log(t)}).on("error",function(t){console.log(t),a.default.set(r.loadings,"publish"+e,!1);var s=t&&t.message?t.message:"";r.$message({message:n.a.t("pixel.publishfailed")+s,type:"error",center:!0})})})}else this.$message({message:n.a.t("pixel.noinputTopic"),type:"warning",center:!0})},showWorksJoin:function(t){this.joinVoteVisible=!0,this.joinVoteNft=t},checkStateAlive:function(t){this.$store.state[t]?this.mynfts=this.$store.state[t]:this.getMyPixelWorks()}},beforeDestroy:function(){},filters:{}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"pixel-container"},[i("div",{staticClass:"valid-container"},[i("div",{staticClass:"my-works"},[i("div",{staticClass:"part-title"},[i("div",{staticClass:"left-border"}),t._v(" "),i("div",{staticClass:"center-text"},[t._v(t._s(t.$t("pixel.myworks")))])]),t._v(" "),i("div",{staticClass:"works-list"},[t._l(t.mynfts,function(e,s){return i("div",{key:s,staticClass:"work-item"},[i("div",{staticClass:"item-img",style:{backgroundImage:"url("+e.url+")"}}),t._v(" "),i("div",{staticClass:"item-info"},[i("span",[t._v(t._s(e.name))])]),t._v(" "),i("div",{staticClass:"item-btn"},[i("el-button",{staticClass:"gradient size",attrs:{round:"",loading:!1},on:{click:function(s){return t.showWorksJoin(e)}}},[t._v(t._s(t.$t("pixel.joinvote")))])],1)])}),t._v(" "),i("div",{staticClass:"work-item",staticStyle:{content:"''",height:"0"}})],2),t._v(" "),i("div",{staticClass:"bottom-tips"},[t._v(t._s(t.$t("pixel.gocreate")))])])]),t._v(" "),t.joinVoteNft?i("el-dialog",{attrs:{title:t.$t("pixel.publish"),visible:t.joinVoteVisible,center:"","modal-append-to-body":!1},on:{"update:visible":function(e){t.joinVoteVisible=e}}},[i("div",{staticClass:"join-box"},[i("div",{staticClass:"tips"},[i("span",{staticClass:"vote-title"},[t._v(t._s(t.proposal.name))])]),t._v(" "),i("div",{staticClass:"tips"},[0==t.proposal.status?i("span",[t._v(t._s(t.$t("pixel.beforeact"))+t._s(t.proposal.remainTimeStr))]):t._e(),t._v(" "),1==t.proposal.status?i("span",[t._v(t._s(t.$t("pixel.inact"))+t._s(t.proposal.remainTimeStr))]):t._e(),t._v(" "),2==t.proposal.status?i("span",[t._v(t._s(t.$t("pixel.beforevote"))+t._s(t.proposal.remainTimeStr))]):t._e(),t._v(" "),3==t.proposal.status?i("span",[t._v(t._s(t.$t("pixel.afteract")))]):t._e()]),t._v(" "),i("div",{staticClass:"topic-select"},[i("div",{staticClass:"label"},[t._v(t._s(t.$t("pixel.relatetopic")))]),t._v(" "),i("div",{staticClass:"input"},[i("el-select",{attrs:{placeholder:t.$t("pixel.selecttopic")},model:{value:t.selectTopic,callback:function(e){t.selectTopic=e},expression:"selectTopic"}},t._l(t.nftCards,function(t){return i("el-option",{key:t.value,attrs:{label:t.name,value:t.value}})}),1)],1)]),t._v(" "),i("el-button",{staticClass:"gradient size",attrs:{round:"",loading:t.loadings["publish"+t.joinVoteNft.id]},on:{click:function(e){return t.toWall()}}},[t._v(t._s(t.$t("common.confirm")))]),t._v(" "),i("p",{staticStyle:{color:"#da56a6","margin-top":"10px"}},[t._v(t._s(t.$t("activity.artdesc1")))]),t._v(" "),i("p",{staticStyle:{color:"#da56a6"}},[t._v(t._s(t.$t("activity.artdesc2")))]),t._v(" "),i("div",{staticClass:"close-btn"},[i("div",{staticClass:"icon",on:{click:function(e){t.joinVoteVisible=!1}}},[i("img",{attrs:{src:s("ScAH"),alt:"close"}})])])],1)]):t._e()],1)},staticRenderFns:[]};var d=s("VU/8")(p,u,!1,function(t){s("UOaP")},"data-v-0c13350d",null);e.default=d.exports},UOaP:function(t,e){}});
//# sourceMappingURL=12.1ec7936ad0e5a5bd41b0.js.map